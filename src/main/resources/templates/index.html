<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Cloud Based Storage System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css">
</head>

<body>

  <div class="container">
    <h1 class="mt-5">Cloud Based Storage System</h1>
    <h1>Login Form</h1>
    <form method="POST" action="http://localhost:8080/users/login">
      <label for="userId">User ID:</label>
      <input type="text" id="userId" name="userId"><br><br>
      <label for="password">Password:</label>
      <input type="password" id="password" name="password"><br><br>
      <input type="submit" value="Login">
    </form>
    <div class="row mt-5">
        <h2>Upload a File</h2>
        <form action="/users/files" method="post" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="file" class="form-label">Choose File</label>
            <input type="file" class="form-control" id="file" name="file" />
          </div>

          <div class="mb-3">
            <label for="userId" class="form-label">User ID</label>
            <input type="text" class="form-control" id="userId" name="userId" />
          </div>
          <button type="submit" class="btn btn-primary">Upload</button>
        </form>
      </div><br>
    
        <h2>Download a File</h2>
        <form action="/users/files" method="get" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="userId" class="form-label">User ID</label>
            <input type="text" class="form-control" id="userId" name="userId" />
          </div>
          <button type="submit" class="btn btn-primary">Download</button>

          </form>
          <br>
          <div id="table"></div>
  </div>

      <script>
        // Get the form element
        const form = document.querySelector('form');

        // Add an event listener to the form submission
        form.addEventListener('submit', (event) => {
          // Prevent the default behavior of the form
          event.preventDefault();

          // Get the user ID input value
          const userId = document.getElementById('userId').value;

          // Get the file input value
          const file = document.getElementById('file').value;

          console.log(file);
          // Create a confirmation message
          const message = `File uploaded for user "${userId}" successfully! ✔️ `;

          // Create a checkmark symbol
          const checkmark = document.createElement('i');
          checkmark.classList.add('bi', 'bi-check-circle');

          // Create a container for the message and checkmark
          const container = document.createElement('div');
          container.classList.add('mt-3', 'd-flex', 'align-items-center');
          container.appendChild(checkmark);
          container.appendChild(document.createTextNode(message));

          // Get the form element and insert the container after it
          const formElement = document.querySelector('form');
          formElement.parentNode.insertBefore(container, formElement.nextSibling);
        });


        userId= document.getElementById('userId').value;
           // Load JSON data
          
    fetch('/users/files?userId='+userId)
      .then(response => response.json())
      .then(data => {
        // Build HTML table
        let table = '<table class="table table-striped table-bordered">';
        table += '<thead><tr><th>User Name </th><th>File Name'
        table += '</th></tr></thead>';
        table += '<tbody>';
        data.forEach(user => {
          table += '<tr>';
          table += `<td>${user.userId}</td>`;
          table += `<td>${user.fileName}</td>`;
          table += '</tr>';
        });
        table += '</tbody>';
        table += '</table>';

        // Insert table into document
        document.querySelector('#table').innerHTML = table;
      });
       

      </script>
</body>

</html>